cache:
  paths:
    - .gradle
    - build

stages:
  - build

backend_gradle_build:
  variables:
    GRADLE_OPTS: "-Dorg.gradle.daemon=false"
    RULES_CHANGES_PATH: "src/**/*"
  stage: build
  image: gradle:7.5.1-jdk11-alpine
  script:
    - export GRADLE_USER_HOME="$(pwd)/.gradle"
    - gradle clean bootJar --build-cache

backend_docker_build:
  variables:
    RULES_CHANGES_PATH: "src/**/*"
  stage: build
  image: hosppy/docker:alpine
  script:
    - docker build -t hosppy/svc .

frontend_build:
  variables:
    RULES_CHANGES_PATH: "app/**/*"
  stage: build
  image: hosppy/docker:alpine
  script:
    - cd app
    - docker build -t hosppy/app .